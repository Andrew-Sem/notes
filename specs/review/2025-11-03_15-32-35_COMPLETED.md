# Review Issues - 2025-11-03_15-32-35

**Target Documents:** specs/prd.md
**Total Issues Found:** 15 (High: 5, Medium: 8, Low: 2)
**Cross-File Issues:** 0 (single document review)

---

## Issue #1: [inconsistency][high] Voice message support contradicts between EPIC-001 description and FR-006
**Files:** specs/prd.md:98, specs/prd.md:208
**Evidence:**
```
specs/prd.md:98: "users can send various types of messages to the Telegram bot" (EPIC-001 description mentions voice)
specs/prd.md:194: "As a user I want to send a voice message to the bot to capture an idea by voice when there's no time to type" (STORY-004)
specs/prd.md:208: "Bot must support photos (photo), videos (video), documents (document). Voice messages are out of scope for MVP."
```

**Options:**
- A) Remove all voice message references from EPIC-001 description and STORY-004, keep FR-006 as-is (no voice in MVP)
- B) Add voice message support back to FR-006 to match EPIC-001 and STORY-004
- C) Move voice message references to "Out of Scope" section and remove STORY-004
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: A]

---

## Issue #2: [ambiguity][medium] File size limits unclear between Telegram limits and application limits
**Files:** specs/prd.md:213
**Evidence:**
```
specs/prd.md:213: "Maximum file size follows Telegram limits: 2 GB (regular users), 4 GB (Premium users). Photos are auto-compressed to ~5-10 MB by Telegram. **Application limit: Files up to 20 MB are saved to S3 storage. Files > 20 MB are rejected with notification 'Files over 20 MB are not supported'.**"
```

**Options:**
- A) Clarify that app enforces 20 MB limit regardless of Telegram's higher limits (simplify statement)
- B) Explain why 20 MB limit exists (cost, storage, performance reasons)
- C) Document handling of Telegram's compression behavior explicitly
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: Clarify that app enforces 20 MB limit in MVP regardless of Telegram's higher limits]

---

## Issue #3: [inconsistency][high] FR-004 and FR-147 both specify file upload failure handling with conflicting details
**Files:** specs/prd.md:147, specs/prd.md:213
**Evidence:**
```
specs/prd.md:147: "If saving fails, bot notifies user. Files up to 20 MB are downloaded and saved to S3. Files > 20 MB are rejected with message 'Files over 20 MB are not supported'. If S3 upload fails, user must manually re-send (no automatic retry)"
specs/prd.md:213: "**Application limit: Files up to 20 MB are saved to S3 storage. Files > 20 MB are rejected with notification 'Files over 20 MB are not supported'.**"
```

**Options:**
- A) Consolidate file handling rules into single FR, remove duplication
- B) Make FR-004 generic ("bot notifies on failure") and keep specific limits in FR-011
- C) Keep both but ensure exact wording matches
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: A]

---

## Issue #4: [missing_info][medium] No specification for media file deletion when note is deleted
**Files:** specs/prd.md:569
**Evidence:**
```
specs/prd.md:569: "Deleted notes are completely removed from database (including media files from storage)"
```

**Options:**
- A) Add FR specifying cascade deletion: "When note with media is deleted, associated files in S3 must also be deleted"
- B) Keep current wording as sufficient (implementation detail)
- C) Add acceptance criteria to FEAT-007 about verifying media deletion
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: Add FR: Media file deletion is handled via Telegram events - when user deletes message in Telegram, bot receives delete event and removes associated files from S3]

---

## Issue #5: [ambiguity][medium] Text preview definition lacks handling of media-only notes
**Files:** specs/prd.md:347
**Evidence:**
```
specs/prd.md:347: "Each note in list shows: text preview (first 100 printable characters with formatting stripped and whitespace collapsed), content type (icon), creation time, tags (if any)"
specs/prd.md:210: "For media messages with caption, the caption text must also be saved. Media without captions is stored with empty caption field and searchable only by metadata (date, type, folder, tags)."
```

**Options:**
- A) Clarify FR-017: "text preview (first 100 printable characters of text/caption, or '[Media]' for media-only notes, with formatting stripped and whitespace collapsed)"
- B) Add separate handling: "For media-only notes, show content type label instead of text preview"
- C) Always show filename or media type description for media notes
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: For media-only notes (no caption), show the media content itself in preview (thumbnail for photos/videos, file icon/name for documents)]

---

## Issue #6: [inconsistency][high] Folder nesting mentioned but contradicted later
**Files:** specs/prd.md:493, specs/prd.md:823
**Evidence:**
```
specs/prd.md:493: "User can create folders with arbitrary names (up to 50 characters). Folders use flat structure only (no nesting) in MVP."
specs/prd.md:823: "Nested folders: Folder hierarchy and subfolders (MVP supports flat folder structure only)"
```

**Options:**
- A) Keep both mentions (they are consistent), no change needed
- B) Remove redundant mention from Out of Scope section since it's already specified in FR-028
- C) Clarify in FR-028 that nested folders are explicitly planned for post-MVP
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: B]

---

## Issue #7: [ambiguity][medium] Search debounce of 300ms only mentioned in acceptance criteria, not in FR
**Files:** specs/prd.md:405
**Evidence:**
```
specs/prd.md:405: "When entering query in search bar, results are displayed with debounce of 300ms"
specs/prd.md:396-401: (FR-022 to FR-026 do not mention debounce timing)
```

**Options:**
- A) Add debounce specification to FR-022: "Search bar must implement 300ms debounce to avoid excessive API calls"
- B) Keep debounce as AC-only (implementation detail)
- C) Make debounce configurable and reference it as configuration value
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: A]

---

## Issue #8: [missing_info][medium] No specification for maximum number of folders per user
**Files:** specs/prd.md:493
**Evidence:**
```
specs/prd.md:493: "User can create folders with arbitrary names (up to 50 characters)"
(No limit on number of folders specified)
```

**Options:**
- A) Add limit: "Users can create up to 100 folders"
- B) Add FR: "No hard limit on folder count; performance considerations apply for >1000 folders"
- C) Leave unlimited and document as "defined in configuration"
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: No limits on folder count in MVP]

---

## Issue #9: [inconsistency][medium] Tag count limit inconsistency in FR-031 and FR-032
**Files:** specs/prd.md:496, specs/prd.md:497
**Evidence:**
```
specs/prd.md:496: "User can add multiple tags to note (up to 10 tags per note)"
specs/prd.md:497: "Tags are entered in free form, automatically created on first use. Tags are case-sensitive and preserve exact user input. Tags support emoji characters (e.g., 'ðŸ’¡Idea', 'ðŸ”¥Important')."
```

**Options:**
- A) No issue - FR-031 specifies limit, FR-032 specifies behavior (consistent)
- B) Clarify that 10-tag limit applies regardless of tag length or emoji usage
- C) Add validation details: tag length limit, allowed characters
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: B]

---

## Issue #10: [missing_info][high] No authentication flow specified for Mini App
**Files:** specs/prd.md:806
**Evidence:**
```
specs/prd.md:806: "Telegram Mini App: React frontend using @telegram-apps/sdk for authentication (https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/2-x), embedded in Telegram"
specs/prd.md:36: "Authentication via Telegram (using Telegram User ID)"
```

**Options:**
- A) Add FR to EPIC-002 specifying Mini App authentication: "Mini App must authenticate users using Telegram WebApp initData validation"
- B) Add new feature "Authentication and Authorization" under EPIC-002 with detailed flow
- C) Keep current high-level mention as sufficient for MVP scope
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: A]

---

## Issue #11: [ambiguity][medium] "Last-write-wins" strategy mentioned but no FR covers it
**Files:** specs/prd.md:567
**Evidence:**
```
specs/prd.md:567: "When editing metadata is updated 'last_edited' (time of last change). Concurrent edits use last-write-wins strategy (no conflict detection or version control in MVP)."
specs/prd.md:824: "Version control: Edit history and conflict resolution for concurrent edits (MVP uses last-write-wins)"
```

**Options:**
- A) Add FR-040a: "Concurrent edits are handled using last-write-wins strategy; no conflict detection in MVP"
- B) Move this detail to "Out of Scope" section only
- C) Keep inline mention in FR-040 as sufficient
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: A]

---

## Issue #12: [missing_info][high] No rate limiting or anti-abuse measures specified
**Files:** specs/prd.md:98 (EPIC-001), specs/prd.md:34-40 (Security section)
**Evidence:**
```
specs/prd.md:38: "API protection between components via tokens/API keys"
(No mention of rate limiting for bot messages or API calls)
```

**Options:**
- A) Add FR to EPIC-001: "Bot must implement rate limiting: max 30 messages per minute per user to prevent abuse"
- B) Add to Security section: "Rate limiting enforced on both bot and API endpoints"
- C) Document as "defined in configuration" without specific values in PRD
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: No custom rate limiting - application relies on Telegram's built-in rate limits only]

---

## Issue #13: [ambiguity][low] BM25 algorithm mentioned but no context on implementation
**Files:** specs/prd.md:398
**Evidence:**
```
specs/prd.md:398: "Search results are displayed using BM25 algorithm for relevance ranking"
```

**Options:**
- A) Add context: "Search uses BM25 relevance ranking (supported by PostgreSQL full-text search or dedicated search engine)"
- B) Change to more generic: "Search results ranked by relevance score"
- C) Keep as-is (implementation detail for tech spec)
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: B - Change to generic "Search results ranked by relevance score" since PRD focuses on product behavior, not technical implementation details]

---

## Issue #14: [inconsistency][low] Date format specified only in Localization, not in FR
**Files:** specs/prd.md:45, specs/prd.md:352
**Evidence:**
```
specs/prd.md:45: "Date/Currency Formats: Standard date/time format (MM/DD/YYYY)"
specs/prd.md:352: "Note creation time is displayed in user's local timezone"
```

**Options:**
- A) Align FR-021 with Localization: display format should be MM/DD/YYYY in user's timezone
- B) Change Localization to support user's locale format, not hardcoded MM/DD/YYYY
- C) Add FR specifying date display format explicitly
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: A]

---

## Issue #15: [missing_info][medium] No specification for handling Telegram service disruptions
**Files:** specs/prd.md:98 (EPIC-001)
**Evidence:**
```
(No mention of retry logic, queue handling, or service degradation when Telegram API is unavailable)
```

**Options:**
- A) Add FR: "Bot must implement message queue; if Telegram API fails, retry up to 3 times with exponential backoff"
- B) Add to Out of Scope for MVP: "Advanced retry logic and queue management"
- C) Add acceptance criteria: "Bot handles temporary API failures gracefully and notifies user if message cannot be saved"
- D) Other (custom resolution)

**Resolution:** [RESOLUTION: Out of scope for MVP - assume Telegram has 100% availability, no retry logic needed]

---

## COMPLETED

**Completed at:** 2025-11-03 15:45:00
**Total Issues:** 15
**Issues Resolved:** 15
**Issues Skipped:** 0
**Files Modified:** specs/prd.md

### Summary of Changes Applied:

1. **Issue #1** - Removed voice message references from EPIC-001 and FEAT-002, deleted STORY-004
2. **Issue #2** - Clarified 20 MB file size limit as primary constraint for MVP
3. **Issue #3** - Consolidated file handling rules: simplified FR-004, kept details in FR-011
4. **Issue #4** - Added FR-011a for Telegram delete event handling
5. **Issue #5** - Updated FR-017 to specify media thumbnail/icon display for media-only notes
6. **Issue #6** - Removed redundant nested folders mention from Out of Scope section
7. **Issue #7** - Added 300ms debounce specification to FR-022
8. **Issue #8** - Added "no limit on folder count" to FR-028
9. **Issue #9** - Clarified 10-tag limit applies regardless of length/emoji in FR-031
10. **Issue #10** - Added Mini App authentication details to Security section
11. **Issue #11** - Added FR-040a explicitly documenting last-write-wins strategy
12. **Issue #12** - Added rate limiting clarification to Security section (relies on Telegram limits)
13. **Issue #13** - Changed FR-024 from "BM25 algorithm" to generic "relevance ranking"
14. **Issue #14** - Added MM/DD/YYYY format specification to FR-021
15. **Issue #15** - Added Telegram service disruption handling to Out of Scope section

